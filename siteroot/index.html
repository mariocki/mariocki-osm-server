<!DOCTYPE html>
<html>

<head>
    <title>Custom Tile Server</title>

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Load Leaflet from CDN -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A==" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js" integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA==" crossorigin=""></script>

    <!-- Load Esri Leaflet from CDN -->
    <script src="https://unpkg.com/esri-leaflet@3.0.1/dist/esri-leaflet.js" integrity="sha512-JmpptMCcCg+Rd6x0Dbg6w+mmyzs1M7chHCd9W8HPovnImG2nLAQWn3yltwxXRM7WjKKFFHOAKjjF2SC4CgiFBg==" crossorigin=""></script>

    <script src="./L.KML.js"></script>

    <style>
        h2 {
            font-size: 15px;
        }
        
        html,
        body,
        #map {
            font-family: Arial, Helvetica, sans-serif;
            font-size: 14px;
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }
        
        #basemaps-wrapper {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 400;
            background: white;
            padding: 10px;
        }
        
        #basemaps {
            margin-bottom: 5px;
        }
    </style>
</head>

<body>
    <div id="map"></div>
    <div id="basemaps-wrapper" class="leaflet-bar">
        <select id="basemaps">
            <option value="None">None</option>
            <option value="Topographic">Topographic</option>
            <option value="Oceans">Oceans</option>
            <option value="ImageryClarity">Imagery (Clarity)</option>
        </select><br />
        <input type="checkbox" id="kml" name="kml" value="KML">
        <label for="kml">Show KML layer</label><br />
        <label id="zoom"></label><br />
    </div>

    <script>
        var map = L.map('map').setView([0, 0], 3);

        L.tileLayer('/tile/{z}/{x}/{y}.png', {
            maxZoom: 18,
            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>',
            id: 'base'
        }).addTo(map);

        var basemapLayer;
        var basemapLayerLabels;
        var kmlLayer;

        function setBasemap(basemap) {
            if (basemapLayer) {
                map.removeLayer(basemapLayer);
            }
            if (basemapLayerLabels) {
                map.removeLayer(basemapLayerLabels);
            }

            if (!basemap.includes('None')) {
                basemapLayer = L.esri.basemapLayer(basemap);

                map.addLayer(basemapLayer);

                if (basemap.includes('Imagery')) {
                    basemapLayerLabels = L.esri.basemapLayer('ImageryLabels');
                    map.addLayer(basemapLayerLabels);
                }
            }
        }

        function setKMLLayer(showKml) {
            if (kmlLayer) {
                map.removeLayer(kmlLayer);
            }

            if (showKml) {
                // Load kml file
                fetch('kml/MyPlaces.kml')
                    .then(res => res.text())
                    .then(kmltext => {
                        // Create new kml overlay
                        const parser = new DOMParser();
                        const kml = parser.parseFromString(kmltext, 'text/xml');
                        kmlLayer = new L.KML(kml);
                        map.addLayer(kmlLayer);
                    });
            }
        }

        document
            .querySelector('#basemaps')
            .addEventListener('change', function(e) {
                var basemap = e.target.value;
                setBasemap(basemap);
            });
        document
            .querySelector('#kml')
            .addEventListener('change', function() {
                var showKml = this.checked;
                setKMLLayer(showKml);
            });

        map.on('zoomend', function(ev) {
            document.getElementById('zoom').innerHTML = map.getZoom();
        });
    </script>
</body>

</html>